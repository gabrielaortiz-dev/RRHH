<div class="attendance-list-container">
  <div class="header">
    <h1>Registro de Asistencias</h1>
    <div class="actions">
      <a routerLink="/asistencias/registrar" class="btn-primary">
        <i class="pi pi-plus"></i> Registrar Asistencia
      </a>
      <a routerLink="/asistencias/reportes" class="btn-secondary">
        <i class="pi pi-file"></i> Generar Reporte
      </a>
    </div>
  </div>

  <div class="filters-section">
    <h3>Filtros</h3>
    <div class="filters-grid">
      <div class="filter-group">
        <label>Empleado</label>
        <p-select [options]="empleados()" 
                   [(ngModel)]="empleadoFiltro"
                   optionLabel="nombre"
                   placeholder="Todos los empleados"
                   [showClear]="true">
          <ng-template let-empleado pTemplate="item">
            <div>{{ empleado.nombre }} {{ empleado.apellido }}</div>
          </ng-template>
        </p-select>
      </div>

      <div class="filter-group">
        <label>Fecha Inicio</label>
        <input type="date" 
               [(ngModel)]="fechaInicio"
               pInputText
               placeholder="Seleccione fecha">
      </div>

      <div class="filter-group">
        <label>Fecha Fin</label>
        <input type="date" 
               [(ngModel)]="fechaFin"
               pInputText
               placeholder="Seleccione fecha">
      </div>

      <div class="filter-actions">
        <button pButton type="button" 
                label="Aplicar Filtros" 
                icon="pi pi-filter"
                (click)="aplicarFiltros()">
        </button>
        <button pButton type="button" 
                label="Limpiar" 
                icon="pi pi-times"
                class="p-button-secondary"
                (click)="limpiarFiltros()">
        </button>
        <button pButton type="button" 
                label="Generar Reporte" 
                icon="pi pi-file-pdf"
                class="p-button-info"
                (click)="generarReporte()">
        </button>
      </div>
    </div>
  </div>

  <div class="table-section">
    <p-table [value]="asistencias()" [loading]="loading()" [paginator]="true" [rows]="10">
      <ng-template pTemplate="header">
        <tr>
          <th>Empleado</th>
          <th>Fecha</th>
          <th>Hora Entrada</th>
          <th>Hora Salida</th>
          <th>Estado</th>
          <th>Observaciones</th>
          <th>Acciones</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-asistencia>
        <tr>
          <td>{{ asistencia.nombre_empleado || 'N/A' }}</td>
          <td>{{ formatDate(asistencia.fecha) }}</td>
          <td>{{ formatTime(asistencia.hora_entrada || '') }}</td>
          <td>{{ formatTime(asistencia.hora_salida || '') }}</td>
          <td>
            <p-tag [value]="asistencia.estado_asistencia || 'Completa'" 
                   [severity]="getSeverityEstado(asistencia.estado_asistencia)"></p-tag>
          </td>
          <td>
            <span [pTooltip]="asistencia.observaciones || 'Sin observaciones'" 
                  tooltipPosition="top">
              {{ (asistencia.observaciones || 'N/A').substring(0, 30) }}{{ asistencia.observaciones && asistencia.observaciones.length > 30 ? '...' : '' }}
            </span>
          </td>
          <td>
            <button pButton icon="pi pi-pencil" class="p-button-text p-button-sm" 
                    [routerLink]="['/asistencias/editar', asistencia.id_asistencia]"
                    pTooltip="Editar"></button>
            <button pButton icon="pi pi-trash" class="p-button-text p-button-sm p-button-danger" 
                    (click)="deleteAsistencia(asistencia)"
                    pTooltip="Eliminar"></button>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7" class="text-center">No hay registros de asistencia</td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>

<p-confirmDialog></p-confirmDialog>
<p-toast></p-toast>

