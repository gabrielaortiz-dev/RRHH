<div class="notification-wrapper">
  <!-- Botón de Campana -->
  <button 
    class="notification-button"
    (click)="togglePanel()"
    type="button">
    <i class="pi pi-bell"></i>
    @if (unreadCount() > 0) {
      <span class="badge">{{ unreadCount() }}</span>
    }
  </button>

  <!-- Panel de Notificaciones -->
  @if (panelVisible()) {
    <!-- Backdrop -->
    <div class="backdrop" (click)="closePanel()"></div>
    
    <!-- Panel -->
    <div class="panel">
      <!-- Header -->
      <div class="panel-header">
        <h3>
          <i class="pi pi-bell"></i>
          Notificaciones
          @if (unreadCount() > 0) {
            <span class="count-badge">{{ unreadCount() }}</span>
          }
        </h3>
        <button class="close-btn" (click)="closePanel()" type="button">
          <i class="pi pi-times"></i>
        </button>
      </div>

      <!-- Acciones -->
      <div class="panel-actions">
        @if (notifications().length > 0) {
          <button (click)="markAllAsRead()" type="button">
            <i class="pi pi-check"></i> Marcar todas
          </button>
          <button (click)="deleteAllRead()" type="button">
            <i class="pi pi-trash"></i> Eliminar leídas
          </button>
        }
      </div>

      <!-- Lista de Notificaciones -->
      <div class="panel-content">
        @if (notifications().length > 0) {
          @for (notif of displayedNotifications(); track notif.id) {
            <div 
              class="notif-item"
              [class.unread]="!notif.isRead"
              (click)="onNotificationClick(notif, $event)">
              
              <div class="notif-icon" [class]="'icon-' + notif.type">
                <i [class]="getNotificationIcon(notif.type)"></i>
              </div>
              
              <div class="notif-body">
                <div class="notif-title">
                  {{ notif.title }}
                  @if (!notif.isRead) {
                    <span class="unread-dot"></span>
                  }
                </div>
                <div class="notif-message">{{ notif.message }}</div>
                <div class="notif-time">
                  <i class="pi pi-clock"></i>
                  {{ formatDate(notif.createdAt) }}
                </div>
              </div>
              
              <div class="notif-actions">
                <button (click)="deleteNotification(notif.id, $event)" type="button" title="Eliminar">
                  <i class="pi pi-times"></i>
                </button>
              </div>
            </div>
          }
        } @else {
          <div class="empty">
            <i class="pi pi-inbox"></i>
            <p>No hay notificaciones</p>
          </div>
        }
      </div>
    </div>
  }
</div>
