<div class="app-layout">
  <!-- Sidebar -->
  <div class="sidebar" [class.collapsed]="sidebarCollapsed()">
    <div class="sidebar-header">
      <div class="logo">
        <i class="pi pi-briefcase"></i>
        @if (!sidebarCollapsed()) {
          <span class="logo-text">RRHH System</span>
        }
      </div>
      <button class="toggle-btn" (click)="toggleSidebar()" pButton icon="pi pi-bars" 
              class="p-button-text p-button-rounded"></button>
    </div>

    <div class="sidebar-menu">
      <div class="menu-section">
        @if (!sidebarCollapsed()) {
          <span class="section-title">NAVEGACIÓN</span>
        }
        <ul class="menu-items">
          @for (item of items; track item.label) {
            @if (!item.separator) {
              <li class="menu-item" [class.has-submenu]="item.items" [class.active]="isActive(item)">
                @if (item.items && item.items.length > 0) {
                  <a class="menu-link" (click)="toggleSubmenu(item)" [class.active]="item.expanded"
                     [pTooltip]="sidebarCollapsed() ? item.label : ''" tooltipPosition="right">
                    <i [class]="item.icon"></i>
                    @if (!sidebarCollapsed()) {
                      <span class="menu-text">{{ item.label }}</span>
                      <i class="pi pi-chevron-down submenu-icon" [class.rotated]="item.expanded"></i>
                    }
                  </a>
                  @if (item.expanded && item.items && item.items.length > 0) {
                    <ul class="submenu" [class.collapsed-submenu]="sidebarCollapsed()">
                      @for (subitem of item.items; track subitem.label) {
                        @if (!subitem.separator) {
                          <li>
                            <a [routerLink]="subitem.routerLink" routerLinkActive="active" class="submenu-link"
                               [pTooltip]="sidebarCollapsed() ? subitem.label : ''" tooltipPosition="right">
                              <i [class]="subitem.icon"></i>
                              @if (!sidebarCollapsed()) {
                                <span>{{ subitem.label }}</span>
                              }
                            </a>
                          </li>
                        } @else {
                          <li class="submenu-separator"></li>
                        }
                      }
                    </ul>
                  }
                } @else {
                  @if (item.command) {
                    <a class="menu-link" (click)="executeCommand(item)"
                       [pTooltip]="sidebarCollapsed() ? item.label : ''" tooltipPosition="right">
                      <i [class]="item.icon"></i>
                      @if (!sidebarCollapsed()) {
                        <span class="menu-text">{{ item.label }}</span>
                      }
                    </a>
                  } @else {
                    <a [routerLink]="item.routerLink" routerLinkActive="active" class="menu-link"
                       [pTooltip]="sidebarCollapsed() ? item.label : ''" tooltipPosition="right">
                      <i [class]="item.icon"></i>
                      @if (!sidebarCollapsed()) {
                        <span class="menu-text">{{ item.label }}</span>
                      }
                    </a>
                  }
                }
              </li>
            }
          }
        </ul>
      </div>
    </div>

    <div class="sidebar-footer">
      <div class="user-info" [class.collapsed]="sidebarCollapsed()">
        <div class="user-avatar">
          <i class="pi pi-user"></i>
        </div>
        @if (!sidebarCollapsed()) {
          @if (currentUser(); as user) {
            <div class="user-details">
              <span class="user-name">{{ user.name }}</span>
              <span class="user-role">{{ user.role }}</span>
            </div>
          }
        }
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content" [class.expanded]="sidebarCollapsed()">
    <!-- Top Header -->
    <div class="top-header">
      <div class="header-left">
        <h2 class="page-title">{{ currentPageTitle() }}</h2>
      </div>
      <div class="header-right">
        <app-notification-panel></app-notification-panel>
        <button pButton icon="pi pi-cog" class="p-button-rounded p-button-text" 
                [routerLink]="'/config/general'"></button>
        <button pButton icon="pi pi-sign-out" class="p-button-rounded p-button-text"
                (click)="logout()" pTooltip="Cerrar Sesión" tooltipPosition="bottom"></button>
      </div>
    </div>

    <!-- Content Area -->
    <div class="content-wrapper">
      <router-outlet></router-outlet>
    </div>
  </div>
</div>
